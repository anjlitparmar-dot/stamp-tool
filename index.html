<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gujarat Stamp Act Tool - Sync</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        :root { --primary: #2c3e50; --secondary: #1abc9c; --accent: #e67e22; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: var(--bg); }
        .header { background: var(--primary); color: white; padding: 15px; text-align: center; display: flex; justify-content: space-between; align-items: center; padding: 10px 50px; }
        .main-container { display: flex; padding: 20px; gap: 20px; min-height: 80vh; }
        
        /* Sidebar Styles */
        .sidebar { width: 250px; background: #34495e; color: white; border-radius: 8px; overflow: hidden; }
        .sidebar-header { background: #e74c3c; padding: 15px; text-align: center; cursor: pointer; font-weight: bold; }
        .section-item { padding: 12px 20px; border-bottom: 1px solid #2c3e50; cursor: pointer; transition: 0.3s; }
        .section-item:hover { background: var(--secondary); }

        /* Content Area */
        .content-area { flex-grow: 1; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .content-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        /* Input Box Styles */
        .input-panel { display: flex; gap: 10px; margin-top: 25px; background: #f9f9f9; padding: 20px; border-radius: 10px; align-items: center; flex-wrap: wrap; border: 1px solid #ddd; }
        input[type="text"], input[type="date"] { padding: 10px; border: 1px solid #ccc; border-radius: 5px; outline: none; }
        
        /* Custom File Upload Button */
        .file-upload-wrapper { position: relative; display: inline-block; }
        .file-upload-wrapper label { display: block; font-size: 11px; color: #666; margin-bottom: 3px; }
        input[type="file"] { font-size: 12px; border: 1px solid #ddd; padding: 5px; border-radius: 4px; background: white; width: 180px; }

        .btn-add { background: var(--secondary); color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 16px; }
        .btn-add:hover { background: #16a085; }
        
        #status-msg { margin-top: 10px; display: block; font-weight: bold; color: var(--accent); }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0;">ğŸ“œ àª—à«àªœàª°àª¾àª¤ àª¸à«àªŸà«‡àª®à«àªª àª…àª§àª¿àª¨àª¿àª¯àª® àªŸà«‚àª²</h2>
    <button id="auth_btn" onclick="handleAuthClick()" style="background:#4285F4; color:white; border:none; padding:10px 20px; cursor:pointer; border-radius:5px; font-weight:bold;">ğŸ” Google Drive àª¸àª¾àª¥à«‡ àªœà«‹àª¡à«‹</button>
</div>

<div class="main-container">
    <div class="sidebar">
        <div class="sidebar-header">â† àª®à«àª–à«àª¯ àª®à«‡àª¨à«</div>
        <div class="section-item">àª•àª²àª®-à«§</div>
        <div class="section-item">àª•àª²àª®-à«¨</div>
        <div class="section-item">àª•àª²àª®-à«©</div>
    </div>

    <div class="content-area">
        <div class="content-header">
            <h3>àª•àª²àª®-à«§ <span style="font-size:14px; background:#f1f1f1; padding:5px 10px; border-radius:15px; margin-left:10px; cursor:pointer; border:1px solid #ddd;">ğŸ“ àª¨àª¾àª® àª†àªªà«‹</span></h3>
            <div>
                <button style="background:#f39c12; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">ğŸŒ Language</button>
                <button style="background:#34495e; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; margin-left:5px;">ğŸ–¨ï¸ àªªà«àª°àª¿àª¨à«àªŸ</button>
            </div>
        </div>

        <div style="background:#fffdf2; border:1px solid #ffeaa7; padding:15px; border-radius:8px; margin-top:20px;">
            <strong>ğŸ—¹ àª•àª¾àª¯àª¦àª¾àª•à«€àª¯ àªœà«‹àª—àªµàª¾àªˆ:</strong>
            <p style="color:#555;">àª…àª¹à«€àª‚ àª•àª²àª®àª¨à«€ àª•àª¾àª¯àª¦àª¾àª•à«€àª¯ àªµàª¿àª—àª¤à«‹ àªœà«‹àªµàª¾ àª®àª³àª¶à«‡...</p>
        </div>

        <div class="input-panel">
            <input type="text" id="val-input" placeholder="àªµàª¿àª—àª¤ (àª¦àª¾.àª¤. à«ªà«¦à«¦)" style="width:150px;">
            <input type="date" id="date-input">
            
            <div class="file-upload-wrapper">
                <label>PDF àª«àª¾àª‡àª² àªªàª¸àª‚àª¦ àª•àª°à«‹:</label>
                <input type="file" id="pdf-file-input" accept="application/pdf">
            </div>

            <button class="btn-add" onclick="processEntry()">+ àª‰àª®à«‡àª°à«‹</button>
            <span id="status-msg"></span>
        </div>
    </div>
</div>

<script>
    // --- àª•à«‹àª¨à«àª«àª¿àª—àª°à«‡àª¶àª¨ ---
    const CLIENT_ID = '397668795740-8q3rsm03at45tga2p820pi2pmris2pvu.apps.googleusercontent.com'; 
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';

    let tokenClient;
    let gapiInited = false;

    // 1. àª—à«‚àª—àª² API àª‡àª¨àª¿àª¶àª¿àª¯àª²àª¾àª‡àª àª•àª°à«‹
    function gapiLoaded() {
        gapi.load('client', async () => {
            await gapi.client.init({ discoveryDocs: [DISCOVERY_DOC] });
            gapiInited = true;
        });
    }

    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: SCOPES,
            callback: '', 
        });
    }

    function handleAuthClick() {
        tokenClient.callback = async (resp) => {
            if (resp.error !== undefined) throw (resp);
            document.getElementById('auth_btn').innerText = "âœ… àª¸àª¿àª‚àª• àªšàª¾àª²à« àª›à«‡";
            document.getElementById('auth_btn').style.background = "#27ae60";
        };
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    // 2. àª®à«àª–à«àª¯ àª«àª‚àª•à«àª¶àª¨: PDF àª…àªªàª²à«‹àª¡ àª…àª¨à«‡ àª¡à«‡àªŸàª¾ àª¸à«‡àªµ
    async function processEntry() {
        const val = document.getElementById('val-input').value;
        const date = document.getElementById('date-input').value;
        const fileInput = document.getElementById('pdf-file-input');
        const status = document.getElementById('status-msg');

        if (!val || !date) {
            alert("àª®àª¹à«‡àª°àª¬àª¾àª¨à«€ àª•àª°à«€àª¨à«‡ àªµàª¿àª—àª¤ àª…àª¨à«‡ àª¤àª¾àª°à«€àª– àª­àª°à«‹.");
            return;
        }

        status.innerText = "â³ àªªà«àª°àª•à«àª°àª¿àª¯àª¾ àªšàª¾àª²à« àª›à«‡...";

        let driveUrl = "No File";

        // àªœà«‹ àª«àª¾àª‡àª² àªªàª¸àª‚àª¦ àª•àª°à«€ àª¹à«‹àª¯ àª¤à«‹ àª…àªªàª²à«‹àª¡ àª•àª°à«‹
        if (fileInput.files.length > 0) {
            status.innerText = "â³ PDF àª¡à«àª°àª¾àª‡àªµ àªªàª° àª…àªªàª²à«‹àª¡ àª¥àªˆ àª°àª¹à«€ àª›à«‡...";
            try {
                const file = fileInput.files[0];
                const metadata = { 'name': file.name, 'mimeType': 'application/pdf' };
                const formData = new FormData();
                formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                formData.append('file', file);

                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink', {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + gapi.client.getToken().access_token }),
                    body: formData
                });

                const result = await response.json();
                driveUrl = result.webViewLink;
            } catch (err) {
                console.error("Upload Error:", err);
                status.innerText = "âŒ àª…àªªàª²à«‹àª¡àª®àª¾àª‚ àª­à«‚àª² àª†àªµà«€!";
                return;
            }
        }

        // àª…àª¹à«€àª‚ àª¤àª®àª¾àª°à«‹ àª¡à«‡àªŸàª¾ àª¸à«‡àªµ àª•àª°àªµàª¾àª¨à«‹ àª•à«‹àª¡ (àªœà«‡àª® àª•à«‡ àª²àª¿àª¸à«àªŸàª®àª¾àª‚ àª‰àª®à«‡àª°àªµà«àª‚)
        console.log("Saving Data:", { value: val, date: date, pdf: driveUrl });
        
        status.innerText = "âœ… àª¸àª«àª³àª¤àª¾àªªà«‚àª°à«àªµàª• àª‰àª®à«‡àª°àª¾àªˆ àª—àª¯à«àª‚!";
        alert("àª¡à«‡àªŸàª¾ àª¸à«‡àªµ àª¥àª¯à«‹ àª…àª¨à«‡ PDF àª¡à«àª°àª¾àª‡àªµ àªªàª° àª…àªªàª²à«‹àª¡ àª¥àªˆ àª—àªˆ!");

        // àª«à«‹àª°à«àª® àª•à«àª²àª¿àª¯àª° àª•àª°à«‹
        document.getElementById('val-input').value = '';
        fileInput.value = '';
    }

    window.onload = () => { gapiLoaded(); };
</script>
<script src="https://accounts.google.com/gsi/client" onload="gisLoaded()" async defer></script>
</body>
</html>
