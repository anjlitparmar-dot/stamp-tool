<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gujarat Stamp Act Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #1abc9c; --bg: #f8f9fa; --accent: #3498db; --text: #2c3e50; --card-bg: #ffffff; }
        * { box-sizing: border-box; font-family: 'Hind Vadodara', sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); }

        /* Home View */
        .home-screen { display: flex; justify-content: center; align-items: center; height: 100vh; gap: 20px; background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%); flex-direction: column; text-align: center; color: white; }
        .tiles-container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .main-tile { width: 200px; height: 160px; background: white; border-radius: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.3); color: #2c3e50; transition: 0.3s; }

        /* Sidebar & Layout */
        #app-view { display: none; height: 100vh; flex-direction: row; }
        .sidebar { width: 320px; background: var(--primary); color: white; display: flex; flex-direction: column; }
        .sidebar-list { flex-grow: 1; overflow-y: auto; list-style: none; padding: 10px; margin: 0; }
        .sidebar-list li { padding: 12px; border-bottom: 1px solid #34495e; cursor: pointer; border-radius: 5px; font-size: 14px; display: flex; justify-content: space-between; }
        .sidebar-list li.active { background: var(--secondary); font-weight: 600; }

        .main-content { flex: 1; overflow-y: auto; padding: 20px; }
        .top-nav { background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        .card { background: var(--card-bg); border-radius: 12px; border: 1px solid rgba(0,0,0,0.1); margin-bottom: 15px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .cat-header { background: #f1f4f7; padding: 10px 15px; font-weight: 600; border-left: 5px solid var(--secondary); color: var(--primary); }
        
        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 14px; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .search-box { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; }

        /* PDF Viewer */
        #pdf-viewer-container { display: none; margin-bottom: 20px; border: 2px solid var(--secondary); border-radius: 12px; overflow: hidden; }
        .pdf-frame { width: 100%; height: 500px; border: none; }
    </style>
</head>
<body>

    <div id="home-view" class="home-screen">
        <h1>àª—à«àªœàª°àª¾àª¤ àª¸à«àªŸà«‡àª®à«àªª àª…àª§àª¿àª¨àª¿àª¯àª®-à«§à«¯à««à«®</h1>
        <div class="tiles-container">
            <div class="main-tile" onclick="openModule('àª•àª²àª®')"><h2>ğŸ“œ àª•àª²àª®</h2></div>
            <div class="main-tile" onclick="openModule('àª†àª°à«àªŸà«€àª•àª²')"><h2>ğŸ“‘ àª†àª°à«àªŸà«€àª•àª²</h2></div>
            <div class="main-tile" onclick="openModule('àªœàª‚àª¤à«àª°à«€')"><h2>ğŸ—ºï¸ àªœàª‚àª¤à«àª°à«€</h2></div>
        </div>
        <div style="margin-top: 20px;">
            <button class="btn" style="background:rgba(255,255,255,0.2); color:white" onclick="exportData()">ğŸ’¾ àª¬à«‡àª•àª…àªª</button>
            <button class="btn" style="background:rgba(255,255,255,0.2); color:white" onclick="document.getElementById('importFile').click()">ğŸ“‚ àª°à«€àª¸à«àªŸà«‹àª°</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(event)">
        </div>
    </div>

    <div id="app-view">
        <div class="sidebar">
            <div style="padding:15px;"><button class="btn" style="background:#e74c3c; color:white; width:100%" onclick="goHome()">â† àª®à«àª–à«àª¯ àª®à«‡àª¨à«</button></div>
            <div style="padding: 0 15px 10px 15px;"><input type="text" id="sideSearch" class="search-box" placeholder="àª¶à«‹àª§à«‹..." oninput="refreshSide()"></div>
            <ul id="item-list" class="sidebar-list"></ul>
        </div>

        <div class="main-content">
            <div class="top-nav">
                <h2 id="current-name" style="flex:1; margin:0;">àªªàª¸àª‚àª¦ àª•àª°à«‹</h2>
                <button class="btn" id="fav-btn" onclick="toggleFav()">â­</button>
                <button class="btn" style="background:var(--primary); color:white; margin-left:10px;" onclick="window.print()">ğŸ–¨ï¸ àªªà«àª°àª¿àª¨à«àªŸ</button>
            </div>

            <div id="pdf-viewer-container" class="card">
                <div style="background:#2c3e50; color:white; padding:10px; display:flex; justify-content:space-between;">
                    <span id="pdf-title">ğŸ“„ PDF Viewer</span>
                    <button onclick="closePDF()" style="background:red; color:white; border:none; padding:5px 10px; cursor:pointer; border-radius:4px;">àª¬àª‚àª§ àª•àª°à«‹ X</button>
                </div>
                <iframe id="pdf-frame" class="pdf-frame" src=""></iframe>
            </div>

            <div class="card" style="padding: 20px; background: #fffdf0;">
                <div style="display:flex; justify-content:space-between;">
                    <strong>ğŸ“– àª•àª¾àª¯àª¦àª¾àª•à«€àª¯ àªœà«‹àª—àªµàª¾àªˆ:</strong>
                    <button class="btn" onclick="editP()" id="p-edit-btn">âœï¸ àª¸à«àª§àª¾àª°à«‹</button>
                </div>
                <div id="p-text" style="white-space:pre-wrap; margin-top:10px;">...</div>
                <textarea id="p-input" style="width:100%; height:150px; display:none; margin-top:10px; padding:10px;"></textarea>
                <button id="p-save" class="btn" style="display:none; margin-top:10px; background:var(--secondary); color:white" onclick="saveP()">àª¸à«‡àªµ àª•àª°à«‹</button>
            </div>

            <div class="card add-section" style="padding:15px;">
                <div style="display:flex; gap:10px; flex-wrap: wrap; align-items: center;">
                    <input type="text" id="fName" placeholder="àªµàª¿àª—àª¤ àª²àª–à«‹" style="flex:1.5; padding:8px; border-radius:5px; border:1px solid #ddd;">
                    <input type="date" id="fDate" style="padding:8px; border-radius:5px; border:1px solid #ddd;">
                    <input type="text" id="fURL" placeholder="PDF àª²àª¿àª‚àª• àªªà«‡àª¸à«àªŸ àª•àª°à«‹ (GitHub/Drive)" style="flex:2; padding:8px; border-radius:5px; border:1px solid #ddd;">
                    <select id="fType" style="padding:8px; border-radius:5px; border:1px solid #ddd;">
                        <option>CCRA àª¹à«àª•àª®</option><option>àªªàª°àª¿àªªàª¤à«àª°</option><option>àª àª°àª¾àªµ</option>
                        <option>àª“àª¡à«€àªŸ àªªà«‡àª°àª¾</option><option>àª•à«‹àª°à«àªŸàª¨àª¾ àªšà«àª•àª¾àª¦àª¾</option>
                    </select>
                    <button class="btn" style="background:var(--secondary); color:white" onclick="addFile()">â• àª‰àª®à«‡àª°à«‹</button>
                </div>
            </div>

            <div id="results-area"></div>
        </div>
    </div>

    <script>
        let curMod = ''; let curItem = '';
        let db = JSON.parse(localStorage.getItem('StampAct_V22')) || null;

        if (!db) {
            db = {"àª•àª²àª®":{}, "àª†àª°à«àªŸà«€àª•àª²":{}, "àªœàª‚àª¤à«àª°à«€":{}};
            for(let i=1; i<=76; i++) db["àª•àª²àª®"][`àª•àª²àª®-${i}`] = { provision: "", files: [], fav: false };
            for(let i=1; i<=59; i++) db["àª†àª°à«àªŸà«€àª•àª²"][`àª†àª°à«àªŸà«€àª•àª²-${i}`] = { provision: "", files: [], fav: false };
            db["àªœàª‚àª¤à«àª°à«€"]["àª®à«àª–à«àª¯ àªœàª‚àª¤à«àª°à«€"] = { provision: "", files: [], fav: false };
            save();
        }

        function save() { localStorage.setItem('StampAct_V22', JSON.stringify(db)); }

        function openModule(m) {
            curMod = m; document.getElementById('home-view').style.display='none';
            document.getElementById('app-view').style.display='flex';
            refreshSide(); selectItem(Object.keys(db[curMod])[0]);
        }

        function goHome() { document.getElementById('home-view').style.display='flex'; document.getElementById('app-view').style.display='none'; }

        function refreshSide() {
            const list = document.getElementById('item-list');
            const search = document.getElementById('sideSearch').value.toLowerCase();
            list.innerHTML = "";
            Object.keys(db[curMod]).forEach(k => {
                if(k.toLowerCase().includes(search)) {
                    const li = document.createElement('li');
                    li.innerHTML = `<span>${db[curMod][k].fav ? 'â­ ' : ''}${k}</span>`;
                    li.onclick = () => selectItem(k);
                    if(k === curItem) li.className = 'active';
                    list.appendChild(li);
                }
            });
        }

        function selectItem(n) {
            curItem = n;
            document.getElementById('current-name').innerText = n;
            document.getElementById('fav-btn').style.color = db[curMod][curItem].fav ? "#f1c40f" : "#ccc";
            document.getElementById('p-text').innerText = db[curMod][curItem].provision || "àª®àª¾àª¹àª¿àª¤à«€ àª­àª°à«‹...";
            renderFiles(); refreshSide(); closePDF();
        }

        // PDF Display Logic
        function viewPDF(url, name) {
            let finalUrl = url;
            // àªœà«‹ àª—à«‚àª—àª² àª¡à«àª°àª¾àªˆàªµàª¨à«€ àª²àª¿àª‚àª• àª¹à«‹àª¯ àª¤à«‹ àª¤à«‡àª¨à«‡ Viewer àª«à«‹àª°à«àª®à«‡àªŸàª®àª¾àª‚ àª«à«‡àª°àªµà«‹
            if (url.includes('drive.google.com')) {
                const fileId = url.match(/[-\w]{25,}/);
                if (fileId) finalUrl = `https://drive.google.com/file/d/${fileId[0]}/preview`;
            }
            document.getElementById('pdf-frame').src = finalUrl;
            document.getElementById('pdf-title').innerText = "ğŸ“„ " + name;
            document.getElementById('pdf-viewer-container').style.display = 'block';
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function closePDF() {
            document.getElementById('pdf-viewer-container').style.display = 'none';
            document.getElementById('pdf-frame').src = "";
        }

        function addFile() {
            const name = document.getElementById('fName').value;
            const date = document.getElementById('fDate').value;
            const url = document.getElementById('fURL').value;
            const type = document.getElementById('fType').value;

            if(!name || !url) return alert("àª¨àª¾àª® àª…àª¨à«‡ àª²àª¿àª‚àª• àªœàª°à«‚àª°à«€ àª›à«‡!");

            db[curMod][curItem].files.push({ id: Date.now(), name, date, url, type, ts: new Date(date).getTime() });
            save(); renderFiles();
            document.getElementById('fName').value = ''; document.getElementById('fURL').value = '';
        }

        function renderFiles() {
            const container = document.getElementById('results-area'); container.innerHTML = "";
            const cats = ["CCRA àª¹à«àª•àª®", "àªªàª°àª¿àªªàª¤à«àª°", "àª àª°àª¾àªµ", "àª“àª¡à«€àªŸ àªªà«‡àª°àª¾", "àª•à«‹àª°à«àªŸàª¨àª¾ àªšà«àª•àª¾àª¦àª¾"];
            cats.forEach(c => {
                let filtered = db[curMod][curItem].files.filter(f => f.type === c).sort((a,b) => b.ts - a.ts);
                if(filtered.length > 0) {
                    let h = `<div class="card"><div class="cat-header">${c}</div><table>`;
                    filtered.forEach(f => {
                        h += `<tr><td width="100">${f.date ? f.date.split('-').reverse().join('-') : '--'}</td>
                        <td><a href="javascript:void(0)" onclick="viewPDF('${f.url}', '${f.name}')" style="text-decoration:none; color:var(--accent); font-weight:600;">ğŸ“„ ${f.name}</a></td>
                        <td width="50"><button onclick="deleteFile(${f.id})" style="border:none; background:none; cursor:pointer;">ğŸ—‘ï¸</button></td></tr>`;
                    });
                    container.innerHTML += h + `</table></div>`;
                }
            });
        }

        function editP() { document.getElementById('p-text').style.display='none'; document.getElementById('p-input').style.display='block'; document.getElementById('p-input').value = db[curMod][curItem].provision; document.getElementById('p-save').style.display='block'; document.getElementById('p-edit-btn').style.display='none'; }
        function saveP() { db[curMod][curItem].provision = document.getElementById('p-input').value; save(); document.getElementById('p-text').innerText = db[curMod][curItem].provision; document.getElementById('p-text').style.display='block'; document.getElementById('p-input').style.display='none'; document.getElementById('p-save').style.display='none'; document.getElementById('p-edit-btn').style.display='block'; }
        function toggleFav() { db[curMod][curItem].fav = !db[curMod][curItem].fav; save(); selectItem(curItem); }
        function deleteFile(fid) { if(confirm("àª•àª¾àª¢à«€ àª¨àª¾àª–àªµà«àª‚ àª›à«‡?")) { db[curMod][curItem].files = db[curMod][curItem].files.filter(f => f.id !== fid); save(); renderFiles(); } }
        function exportData() { const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db)); const dl = document.createElement('a'); dl.setAttribute("href", dataStr); dl.setAttribute("download", "StampAct_Backup.json"); dl.click(); }
        function importData(e) { const reader = new FileReader(); reader.onload = (ev) => { db = JSON.parse(ev.target.result); save(); location.reload(); }; reader.readAsText(e.target.files[0]); }
    </script>
</body>
</html>
