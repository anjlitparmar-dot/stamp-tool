<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gujarat Stamp Act Tool - URL Version</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #1abc9c; --bg: #f8f9fa; --accent: #3498db; --text: #2c3e50; --card-bg: #ffffff; }
        * { box-sizing: border-box; font-family: 'Hind Vadodara', sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); }

        /* рк╣рлЛрко рк╕рлНркХрлНрк░рлАрки ркбрк┐ркЭрк╛ркЗрки */
        .home-screen { display: flex; justify-content: center; align-items: center; height: 100vh; gap: 20px; background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%); flex-direction: column; text-align: center; color: white; }
        .tiles-container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .main-tile { width: 200px; height: 160px; background: white; border-radius: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.3); color: #2c3e50; transition: 0.3s; }
        .main-tile:hover { transform: translateY(-5px); background: #f0fffb; }

        /* ркПркк рк▓рлЗркЖркЙркЯ */
        #app-view { display: none; height: 100vh; flex-direction: row; }
        .sidebar { width: 320px; background: var(--primary); color: white; display: flex; flex-direction: column; }
        .sidebar-list { flex-grow: 1; overflow-y: auto; list-style: none; padding: 10px; margin: 0; }
        .sidebar-list li { padding: 12px; border-bottom: 1px solid #34495e; cursor: pointer; border-radius: 5px; font-size: 14px; display: flex; justify-content: space-between; }
        .sidebar-list li.active { background: var(--secondary); font-weight: 600; }

        .main-content { flex: 1; overflow-y: auto; padding: 20px; position: relative; }
        .top-nav { background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        .card { background: var(--card-bg); border-radius: 12px; border: 1px solid rgba(0,0,0,0.1); margin-bottom: 15px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .cat-header { background: #f1f4f7; padding: 10px 15px; font-weight: 600; border-left: 5px solid var(--secondary); color: var(--primary); }
        
        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 14px; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .search-box { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; }

        /* PDF Viewer */
        #pdf-viewer-container { display: none; margin-bottom: 20px; border: 2px solid var(--secondary); border-radius: 12px; overflow: hidden; background: white; }
        .pdf-frame { width: 100%; height: 600px; border: none; }

        @media print { .sidebar, .top-nav, .add-section, .no-print { display: none !important; } }
    </style>
</head>
<body>

    <div id="home-view" class="home-screen">
        <h1>ркЧрлБркЬрк░рк╛ркд рк╕рлНркЯрлЗркорлНркк ркЕркзрк┐ркирк┐ркпрко-рлзрлпрллрло</h1>
        <p style="opacity: 0.8;">ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ ркЕркирлЗ ркХрк╛ркпркжрк╛ркХрлАркп ркорк╛рк╣рк┐ркдрлАркирлБркВ ркбрк┐ркЬрк┐ркЯрк▓ ркЯрлВрк▓</p>
        
        <div class="tiles-container">
            <div class="main-tile" onclick="openModule('ркХрк▓рко')"><h2>ЁЯУЬ ркХрк▓рко</h2></div>
            <div class="main-tile" onclick="openModule('ркЖрк░рлНркЯрлАркХрк▓')"><h2>ЁЯУС ркЖрк░рлНркЯрлАркХрк▓</h2></div>
            <div class="main-tile" onclick="openModule('ркЬркВркдрлНрк░рлА')"><h2>ЁЯЧ║я╕П ркЬркВркдрлНрк░рлА</h2></div>
        </div>

        <div style="margin-top: 30px; display: flex; gap: 10px;">
            <button class="btn" style="background:rgba(255,255,255,0.2); color:white" onclick="exportData()">ЁЯТ╛ ркмрлЗркХркЕркк (Save JSON)</button>
            <button class="btn" style="background:rgba(255,255,255,0.2); color:white" onclick="document.getElementById('importFile').click()">ЁЯУВ рк░рлАрк╕рлНркЯрлЛрк░ (Load JSON)</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(event)">
        </div>
    </div>

    <div id="app-view">
        <div class="sidebar">
            <div style="padding:15px;"><button class="btn" style="background:#e74c3c; color:white; width:100%" onclick="goHome()">тЖР ркорлБркЦрлНркп ркорлЗркирлБ</button></div>
            <div style="padding: 0 15px 10px 15px;">
                <input type="text" id="sideSearch" class="search-box" placeholder="рк╢рлЛркзрлЛ..." oninput="refreshSide()">
            </div>
            <ul id="item-list" class="sidebar-list"></ul>
        </div>

        <div class="main-content">
            <div class="top-nav">
                <h2 id="current-name" style="flex:1; margin:0;">рккрк╕ркВркж ркХрк░рлЛ</h2>
                <button class="btn" id="fav-btn" onclick="toggleFav()">тнР</button>
                <button class="btn no-print" style="background:var(--primary); color:white; margin-left:10px;" onclick="window.print()">ЁЯЦия╕П рккрлНрк░рк┐ркирлНркЯ</button>
            </div>

            <div id="pdf-viewer-container" class="card">
                <div style="background:#2c3e50; color:white; padding:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span id="pdf-title">ЁЯУД PDF Viewer</span>
                    <button onclick="closePDF()" style="background:red; color:white; border:none; padding:5px 10px; cursor:pointer; border-radius:4px;">ркмркВркз ркХрк░рлЛ X</button>
                </div>
                <iframe id="pdf-frame" class="pdf-frame" src=""></iframe>
            </div>

            <div class="card" style="padding: 20px; background: #fffdf0;">
                <div style="display:flex; justify-content:space-between;">
                    <strong>ЁЯУЦ ркХрк╛ркпркжрк╛ркХрлАркп ркЬрлЛркЧрк╡рк╛ркИ:</strong>
                    <button class="btn no-print" onclick="editP()" id="p-edit-btn">тЬПя╕П рк╕рлБркзрк╛рк░рлЛ</button>
                </div>
                <div id="p-text" style="white-space:pre-wrap; margin-top:10px; line-height:1.6;">ркорк╛рк╣рк┐ркдрлА ркЬрлЛрк╡рк╛ ркорк╛ркЯрлЗ ркбрк╛ркмрлА ркмрк╛ркЬрлБркерлА рккрк╕ркВркж ркХрк░рлЛ...</div>
                <textarea id="p-input" style="width:100%; height:150px; display:none; margin-top:10px; padding:10px; border-radius:8px;"></textarea>
                <button id="p-save" class="btn" style="display:none; margin-top:10px; background:var(--secondary); color:white" onclick="saveP()">рк╕рлЗрк╡ ркХрк░рлЛ</button>
            </div>

            <div class="card add-section" style="padding:15px; background: #eef2f5;">
                <div style="font-weight: bold; margin-bottom: 10px; font-size: 14px; color: #555;">тЮХ ркирк╡рлЛ ркжрк╕рлНркдрк╛рк╡рлЗркЬ ркЙркорлЗрк░рлЛ:</div>
                <div style="display:flex; gap:10px; flex-wrap: wrap; align-items: center;">
                    <input type="text" id="fName" placeholder="ркжрк╕рлНркдрк╛рк╡рлЗркЬркирлА рк╡рк┐ркЧркд (ркжрк╛.ркд. рк╕рлНркЯрлЗркорлНркк ркбрлНркпрлБркЯрлА ркШркЯрк╛ркбрк╛ ркмрк╛ркмркд)" style="flex:2; padding:10px; border-radius:5px; border:1px solid #ddd;">
                    <input type="date" id="fDate" style="padding:10px; border-radius:5px; border:1px solid #ddd;">
                    
                    <input type="text" id="fURL" placeholder="PDF ркирлА рк▓рк┐ркВркХ (URL) ркЕрк╣рлАркВ рккрлЗрк╕рлНркЯ ркХрк░рлЛ" style="flex:3; padding:10px; border-radius:5px; border:1px solid #ddd;">

                    <select id="fType" style="padding:10px; border-radius:5px; border:1px solid #ddd;">
                        <option>CCRA рк╣рлБркХрко</option><option>рккрк░рк┐рккркдрлНрк░</option><option>ркарк░рк╛рк╡</option>
                        <option>ркУркбрлАркЯ рккрлЗрк░рк╛</option><option>ркХрлЛрк░рлНркЯркирк╛ ркЪрлБркХрк╛ркжрк╛</option>
                    </select>
                    <button class="btn" style="background:var(--secondary); color:white; padding: 10px 20px;" onclick="addFile()">тЮХ ркЙркорлЗрк░рлЛ</button>
                </div>
                <p style="font-size: 11px; color: #7f8c8d; margin-top: 8px;">* GitHub ркХрлЗ Google Drive ркорк╛ркВ PDF ркЕрккрк▓рлЛркб ркХрк░рлА ркдрлЗркирлА 'Direct Link' ркЕрк╣рлАркВ рккрлЗрк╕рлНркЯ ркХрк░рлЛ.</p>
            </div>

            <div id="results-area"></div>
        </div>
    </div>

    <script>
        let curMod = ''; let curItem = '';
        let db = JSON.parse(localStorage.getItem('StampAct_V22')) || null;

        // ркбрлЗркЯрк╛ркмрлЗркЭ рк╕рлЗркЯркЕркк
        if (!db) {
            db = {"ркХрк▓рко":{}, "ркЖрк░рлНркЯрлАркХрк▓":{}, "ркЬркВркдрлНрк░рлА":{}};
            for(let i=1; i<=76; i++) db["ркХрк▓рко"][`ркХрк▓рко-${i}`] = { provision: "", files: [], fav: false };
            for(let i=1; i<=59; i++) db["ркЖрк░рлНркЯрлАркХрк▓"][`ркЖрк░рлНркЯрлАркХрк▓-${i}`] = { provision: "", files: [], fav: false };
            db["ркЬркВркдрлНрк░рлА"]["ркорлБркЦрлНркп ркЬркВркдрлНрк░рлА"] = { provision: "", files: [], fav: false };
            save();
        }

        function save() { localStorage.setItem('StampAct_V22', JSON.stringify(db)); }

        function openModule(m) {
            curMod = m; document.getElementById('home-view').style.display='none';
            document.getElementById('app-view').style.display='flex';
            refreshSide(); selectItem(Object.keys(db[curMod])[0]);
        }

        function goHome() { document.getElementById('home-view').style.display='flex'; document.getElementById('app-view').style.display='none'; }

        function refreshSide() {
            const list = document.getElementById('item-list');
            const search = document.getElementById('sideSearch').value.toLowerCase();
            list.innerHTML = "";
            Object.keys(db[curMod]).forEach(k => {
                if(k.toLowerCase().includes(search)) {
                    const li = document.createElement('li');
                    li.innerHTML = `<span>${db[curMod][k].fav ? 'тнР ' : ''}${k}</span>`;
                    li.onclick = () => selectItem(k);
                    if(k === curItem) li.className = 'active';
                    list.appendChild(li);
                }
            });
        }

        function selectItem(n) {
            if(!n) return;
            curItem = n;
            document.getElementById('current-name').innerText = n;
            document.getElementById('fav-btn').style.color = db[curMod][curItem].fav ? "#f1c40f" : "#ccc";
            document.getElementById('p-text').innerText = db[curMod][curItem].provision || "ркорк╛рк╣рк┐ркдрлА рк▓ркЦрк╡рк╛ ркорк╛ркЯрлЗ 'рк╕рлБркзрк╛рк░рлЛ' ркмркЯрки ркжркмрк╛рк╡рлЛ...";
            renderFiles(); refreshSide(); closePDF();
        }

        // PDF рк╡рлНркпрлВркЕрк░ рк▓рлЛркЬрк┐ркХ
        function viewPDF(url, name) {
            let finalUrl = url;
            // Google Drive рк▓рк┐ркВркХркирлЗ рккрлНрк░рк┐рк╡рлНркпрлВркорк╛ркВ рклрлЗрк░рк╡рлЛ
            if (url.includes('drive.google.com')) {
                const fileId = url.match(/[-\w]{25,}/);
                if (fileId) finalUrl = `https://drive.google.com/file/d/${fileId[0]}/preview`;
            }
            // GitHub рк▓рк┐ркВркХ ркЬрлЛ Raw рки рк╣рлЛркп ркдрлЛ ркдрлЗркирлЗ рк╣рлЗркирлНркбрк▓ ркХрк░рк╡рлА (User ркП Raw рк▓рк┐ркВркХ ркЬ ркирк╛ркЦрк╡рлА ркЬрлЛркИркП)

            document.getElementById('pdf-frame').src = finalUrl;
            document.getElementById('pdf-title').innerText = "ЁЯУД " + name;
            document.getElementById('pdf-viewer-container').style.display = 'block';
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function closePDF() {
            document.getElementById('pdf-viewer-container').style.display = 'none';
            document.getElementById('pdf-frame').src = "";
        }

        // рк▓рк┐ркВркХ ркЙркорлЗрк░рк╡рк╛ркирлБркВ рк▓рлЛркЬрк┐ркХ
        function addFile() {
            const name = document.getElementById('fName').value;
            const date = document.getElementById('fDate').value;
            const url = document.getElementById('fURL').value;
            const type = document.getElementById('fType').value;

            if(!name || !url) { alert("ркХрлГрккрк╛ ркХрк░рлАркирлЗ ркирк╛рко ркЕркирлЗ URL рк▓рк┐ркВркХ ркмркВркирлЗ ркнрк░рлЛ!"); return; }

            db[curMod][curItem].files.push({ 
                id: Date.now(), 
                name, 
                date, 
                url, 
                type, 
                ts: date ? new Date(date).getTime() : 0 
            });
            
            save(); 
            renderFiles();
            // рклрлЛрк░рлНрко ркХрлНрк▓рк┐ркпрк░ ркХрк░рлЛ
            document.getElementById('fName').value = '';
            document.getElementById('fURL').value = '';
            document.getElementById('fDate').value = '';
        }

        function renderFiles() {
            const container = document.getElementById('results-area'); 
            container.innerHTML = "";
            const categories = ["CCRA рк╣рлБркХрко", "рккрк░рк┐рккркдрлНрк░", "ркарк░рк╛рк╡", "ркУркбрлАркЯ рккрлЗрк░рк╛", "ркХрлЛрк░рлНркЯркирк╛ ркЪрлБркХрк╛ркжрк╛"];
            
            categories.forEach(cat => {
                let filtered = db[curMod][curItem].files.filter(f => f.type === cat).sort((a,b) => b.ts - a.ts);
                if(filtered.length > 0) {
                    let html = `<div class="card"><div class="cat-header">${cat}</div><table>`;
                    filtered.forEach(f => {
                        let displayDate = f.date ? f.date.split('-').reverse().join('-') : '--';
                        html += `<tr>
                            <td width="100">${displayDate}</td>
                            <td><a href="javascript:void(0)" onclick="viewPDF('${f.url}', '${f.name}')" style="text-decoration:none; color:var(--accent); font-weight:600;">ЁЯУД ${f.name}</a></td>
                            <td width="50" class="no-print"><button onclick="deleteFile(${f.id})" style="border:none; background:none; cursor:pointer; color:red;">ЁЯЧСя╕П</button></td>
                        </tr>`;
                    });
                    container.innerHTML += html + `</table></div>`;
                }
            });
        }

        // ркЕркирлНркп рк╕рк╣рк╛ркпркХ рклркВркХрлНрк╢ркирлНрк╕
        function editP() { document.getElementById('p-text').style.display='none'; document.getElementById('p-input').style.display='block'; document.getElementById('p-input').value = db[curMod][curItem].provision; document.getElementById('p-save').style.display='block'; document.getElementById('p-edit-btn').style.display='none'; }
        function saveP() { db[curMod][curItem].provision = document.getElementById('p-input').value; save(); document.getElementById('p-text').innerText = db[curMod][curItem].provision; document.getElementById('p-text').style.display='block'; document.getElementById('p-input').style.display='none'; document.getElementById('p-save').style.display='none'; document.getElementById('p-edit-btn').style.display='block'; }
        function toggleFav() { db[curMod][curItem].fav = !db[curMod][curItem].fav; save(); refreshSide(); }
        function deleteFile(fid) { if(confirm("ркЖ ркжрк╕рлНркдрк╛рк╡рлЗркЬ ркХрк╛ркврлА ркирк╛ркЦрк╡рлЛ ркЫрлЗ?")) { db[curMod][curItem].files = db[curMod][curItem].files.filter(f => f.id !== fid); save(); renderFiles(); } }
        
        // ркмрлЗркХркЕркк ркЕркирлЗ рк░рлАрк╕рлНркЯрлЛрк░
        function exportData() { 
            const blob = new Blob([JSON.stringify(db)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `StampTool_Backup_${new Date().toLocaleDateString()}.json`;
            a.click();
        }
        function importData(e) { 
            const reader = new FileReader(); 
            reader.onload = (ev) => { 
                try {
                    db = JSON.parse(ev.target.result); 
                    save(); 
                    location.reload(); 
                } catch(err) { alert("ркЦрлЛркЯрлА рклрк╛ркИрк▓! ркорк╣рлЗрк░ркмрк╛ркирлА ркХрк░рлАркирлЗ рк╕рк╛ркЪрлА JSON ркмрлЗркХркЕркк рклрк╛ркИрк▓ рккрк╕ркВркж ркХрк░рлЛ."); }
            }; 
            reader.readAsText(e.target.files[0]); 
        }
    </script>
</body>
</html>
