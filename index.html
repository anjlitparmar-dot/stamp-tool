<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gujarat Stamp Act Tool - Advanced</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --secondary: #1abc9c; --bg: #f8f9fa; --accent: #3498db; --text: #2c3e50; --card-bg: #ffffff; }
        * { box-sizing: border-box; font-family: 'Hind Vadodara', sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); }

        /* àª¹à«‹àª® àª¸à«àª•à«àª°à«€àª¨ àª…àª¨à«‡ àª—à«àª²à«‹àª¬àª² àª¸àª°à«àªš */
        .home-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%); flex-direction: column; text-align: center; color: white; }
        .global-search-container { width: 100%; max-width: 600px; margin-bottom: 40px; }
        .global-search { width: 100%; padding: 15px 25px; border-radius: 30px; border: none; font-size: 18px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        
        .tiles-container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; margin-bottom: 30px; }
        .main-tile { width: 180px; height: 140px; background: white; border-radius: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; color: #2c3e50; transition: 0.3s; }
        .main-tile:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(255,255,255,0.1); }

        /* àªàªª àª²à«‡àª†àª‰àªŸ */
        #app-view { display: none; height: 100vh; flex-direction: row; }
        .sidebar { width: 320px; background: var(--primary); color: white; display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.1); }
        .sidebar-list { flex-grow: 1; overflow-y: auto; list-style: none; padding: 10px; margin: 0; }
        .sidebar-list li { padding: 12px; border-bottom: 1px solid #34495e; cursor: pointer; border-radius: 8px; margin-bottom: 5px; font-size: 14px; }
        .sidebar-list li.active { background: var(--secondary); font-weight: 600; }
        .sidebar-list li:hover:not(.active) { background: rgba(255,255,255,0.1); }

        .main-content { flex: 1; overflow-y: auto; padding: 25px; background: #f0f2f5; }
        .top-nav { background: white; padding: 15px 25px; border-radius: 15px; margin-bottom: 20px; display: flex; gap: 15px; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 10; }
        
        .card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #eef0f2; }
        .cat-header { background: #f8fafc; padding: 12px 18px; font-weight: 600; border-left: 5px solid var(--secondary); margin: -20px -20px 15px -20px; color: var(--primary); font-size: 15px; }

        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 14px; }
        .btn-primary { background: var(--secondary); color: white; }
        .btn-outline { background: transparent; border: 1px solid #ddd; color: #555; }
        
        .input-field { padding: 12px; border-radius: 8px; border: 1px solid #ddd; outline: none; }
        .input-field:focus { border-color: var(--secondary); }

        #pdf-viewer-container { display: none; margin-bottom: 20px; border-radius: 15px; overflow: hidden; border: 2px solid var(--secondary); }
        iframe { width: 100%; height: 550px; border: none; }

        @media print { .sidebar, .no-print, .add-section, .top-nav { display: none !important; } .main-content { padding: 0; } }
    </style>
</head>
<body>

    <div id="home-view" class="home-screen">
        <h1 style="font-size: 32px; margin-bottom: 10px;">àª—à«àªœàª°àª¾àª¤ àª¸à«àªŸà«‡àª®à«àªª àª…àª§àª¿àª¨àª¿àª¯àª® àªŸà«‚àª²</h1>
        
        <div class="global-search-container">
            <input type="text" class="global-search" id="mainSearch" placeholder="àª•à«‹àªˆàªªàª£ àª•àª²àª®, àª†àª°à«àªŸà«€àª•àª² àª•à«‡ àªµàª¿àª—àª¤ àª¶à«‹àª§à«‹..." oninput="globalSearch()">
            <div id="search-results" style="text-align: left; margin-top: 10px;"></div>
        </div>

        <div class="tiles-container">
            <div class="main-tile" onclick="openModule('àª•àª²àª®')"><h2>ğŸ“œ àª•àª²àª®</h2></div>
            <div class="main-tile" onclick="openModule('àª†àª°à«àªŸà«€àª•àª²')"><h2>ğŸ“‘ àª†àª°à«àªŸà«€àª•àª²</h2></div>
            <div class="main-tile" onclick="openModule('àªœàª‚àª¤à«àª°à«€')"><h2>ğŸ—ºï¸ àªœàª‚àª¤à«àª°à«€</h2></div>
        </div>

        <div style="display: flex; gap: 15px;">
            <button class="btn btn-outline" style="color:white; border-color:rgba(255,255,255,0.3)" onclick="exportData()">ğŸ’¾ àª¬à«‡àª•àª…àªª</button>
            <button class="btn btn-outline" style="color:white; border-color:rgba(255,255,255,0.3)" onclick="document.getElementById('importFile').click()">ğŸ“‚ àª°à«€àª¸à«àªŸà«‹àª°</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(event)">
        </div>
    </div>

    <div id="app-view">
        <div class="sidebar">
            <div style="padding:20px;"><button class="btn btn-primary" style="width:100%; background:#e74c3c" onclick="goHome()">â† àª®à«àª–à«àª¯ àª®à«‡àª¨à«</button></div>
            <div style="padding: 0 20px 10px 20px;">
                <input type="text" id="sideSearch" class="input-field" style="width:100%; background: #34495e; color:white; border:none;" placeholder="àª«àª¿àª²à«àªŸàª° àª•àª°à«‹..." oninput="refreshSide()">
            </div>
            <ul id="item-list" class="sidebar-list"></ul>
        </div>

        <div class="main-content">
            <div class="top-nav">
                <div style="flex:1">
                    <h2 id="current-name" style="margin:0; font-size: 20px;">àªªàª¸àª‚àª¦ àª•àª°à«‹</h2>
                    <div id="title-display-area" style="margin-top:5px; color: var(--secondary); font-weight: 600; cursor: pointer;" onclick="editTitle()">
                        <span id="item-title-text">àª¶à«€àª°à«àª·àª• àª‰àª®à«‡àª°à«‹...</span> âœï¸
                    </div>
                    <div id="title-edit-area" style="display: none; margin-top: 5px; gap: 5px;">
                        <input type="text" id="item-title-input" class="input-field" style="padding:5px;" placeholder="àª¨àªµà«àª‚ àª¶à«€àª°à«àª·àª• àª²àª–à«‹">
                        <button class="btn btn-primary" style="padding:5px 10px;" onclick="saveTitle()">àª¸à«‡àªµ</button>
                    </div>
                </div>
                <button class="btn btn-outline" id="fav-btn" onclick="toggleFav()">â­</button>
                <button class="btn btn-primary no-print" onclick="window.print()">ğŸ–¨ï¸ àªªà«àª°àª¿àª¨à«àªŸ</button>
            </div>

            <div id="pdf-viewer-container">
                <div style="background:#2c3e50; color:white; padding:10px; display:flex; justify-content:space-between;">
                    <span id="pdf-title-bar">ğŸ“„ PDF Viewer</span>
                    <button onclick="closePDF()" style="background:red; color:white; border:none; cursor:pointer;">X</button>
                </div>
                <iframe id="pdf-frame" src=""></iframe>
            </div>

            <div class="card" style="background: #fffdf2;">
                <div style="display:flex; justify-content:space-between; align-items: center; margin-bottom:15px;">
                    <strong>ğŸ“– àª•àª¾àª¯àª¦àª¾àª•à«€àª¯ àªœà«‹àª—àªµàª¾àªˆ:</strong>
                    <button class="btn btn-outline" onclick="editP()" id="p-edit-btn">âœï¸ àª¸à«àª§àª¾àª°à«‹</button>
                </div>
                <div id="p-text" style="white-space:pre-wrap; line-height:1.7;">àª®àª¾àª¹àª¿àª¤à«€ àªœà«‹àªµàª¾ àª®àª¾àªŸà«‡ àªªàª¸àª‚àª¦ àª•àª°à«‹...</div>
                <textarea id="p-input" class="input-field" style="width:100%; height:180px; display:none;"></textarea>
                <button id="p-save" class="btn btn-primary" style="display:none; margin-top:10px;" onclick="saveP()">àª¸à«‡àªµ àª•àª°à«‹</button>
            </div>

            <div class="card add-section">
                <div class="cat-header" style="background:#eef2f5;">â• àª¨àªµà«‹ àª¦àª¸à«àª¤àª¾àªµà«‡àªœ àª‰àª®à«‡àª°à«‹</div>
                <div style="display:flex; gap:10px; flex-wrap: wrap;">
                    <input type="text" id="fName" placeholder="àª¦àª¸à«àª¤àª¾àªµà«‡àªœàª¨à«€ àªµàª¿àª—àª¤" class="input-field" style="flex:2;">
                    <input type="date" id="fDate" class="input-field">
                    <input type="text" id="fURL" placeholder="PDF URL àª²àª¿àª‚àª•" class="input-field" style="flex:3;">
                    <select id="fType" class="input-field">
                        <option>CCRA àª¹à«àª•àª®</option><option>àªªàª°àª¿àªªàª¤à«àª°</option><option>àª àª°àª¾àªµ</option>
                        <option>àª“àª¡à«€àªŸ àªªà«‡àª°àª¾</option><option>àª•à«‹àª°à«àªŸàª¨àª¾ àªšà«àª•àª¾àª¦àª¾</option>
                    </select>
                    <button class="btn btn-primary" onclick="addFile()">â• àª‰àª®à«‡àª°à«‹</button>
                </div>
            </div>

            <div id="results-area"></div>
        </div>
    </div>

    <script>
        let curMod = ''; let curItem = '';
        let db = JSON.parse(localStorage.getItem('StampAct_Pro_V1')) || null;

        if (!db) {
            db = {"àª•àª²àª®":{}, "àª†àª°à«àªŸà«€àª•àª²":{}, "àªœàª‚àª¤à«àª°à«€":{}};
            for(let i=1; i<=76; i++) db["àª•àª²àª®"][`àª•àª²àª®-${i}`] = { title: "", provision: "", files: [], fav: false };
            for(let i=1; i<=59; i++) db["àª†àª°à«àªŸà«€àª•àª²"][`àª†àª°à«àªŸà«€àª•àª²-${i}`] = { title: "", provision: "", files: [], fav: false };
            db["àªœàª‚àª¤à«àª°à«€"]["àª®à«àª–à«àª¯ àªœàª‚àª¤à«àª°à«€"] = { title: "", provision: "", files: [], fav: false };
            save();
        }

        function save() { localStorage.setItem('StampAct_Pro_V1', JSON.stringify(db)); }

        function goHome() { 
            document.getElementById('home-view').style.display='flex'; 
            document.getElementById('app-view').style.display='none';
            document.getElementById('mainSearch').value = '';
            document.getElementById('search-results').innerHTML = '';
        }

        function openModule(m) {
            curMod = m; document.getElementById('home-view').style.display='none';
            document.getElementById('app-view').style.display='flex';
            refreshSide(); selectItem(Object.keys(db[curMod])[0]);
        }

        // àª—à«àª²à«‹àª¬àª² àª¸àª°à«àªš àª²à«‹àªœàª¿àª•
        function globalSearch() {
            const query = document.getElementById('mainSearch').value.toLowerCase();
            const resultsDiv = document.getElementById('search-results');
            if(query.length < 2) { resultsDiv.innerHTML = ''; return; }
            
            let html = '<div style="background:white; color:black; border-radius:10px; padding:10px; max-height:300px; overflow-y:auto; box-shadow:0 5px 15px rgba(0,0,0,0.3);">';
            ["àª•àª²àª®", "àª†àª°à«àªŸà«€àª•àª²", "àªœàª‚àª¤à«àª°à«€"].forEach(mod => {
                Object.keys(db[mod]).forEach(item => {
                    const data = db[mod][item];
                    if(item.toLowerCase().includes(query) || data.title.toLowerCase().includes(query) || data.provision.toLowerCase().includes(query)) {
                        html += `<div style="padding:10px; border-bottom:1px solid #eee; cursor:pointer;" onclick="quickAccess('${mod}', '${item}')">
                            <small style="color:var(--secondary)">${mod}</small> | <strong>${item}</strong> - <small>${data.title || 'àªµàª¿àª—àª¤ àªµàª—àª°'}</small>
                        </div>`;
                    }
                });
            });
            resultsDiv.innerHTML = html + '</div>';
        }

        function quickAccess(mod, item) {
            curMod = mod;
            document.getElementById('home-view').style.display='none';
            document.getElementById('app-view').style.display='flex';
            refreshSide();
            selectItem(item);
        }

        function refreshSide() {
            const list = document.getElementById('item-list');
            const search = document.getElementById('sideSearch').value.toLowerCase();
            list.innerHTML = "";
            Object.keys(db[curMod]).forEach(k => {
                if(k.toLowerCase().includes(search) || db[curMod][k].title.toLowerCase().includes(search)) {
                    const li = document.createElement('li');
                    li.innerHTML = `<span>${db[curMod][k].fav ? 'â­ ' : ''}${k}</span><br><small style="opacity:0.7">${db[curMod][k].title || ''}</small>`;
                    li.onclick = () => selectItem(k);
                    if(k === curItem) li.className = 'active';
                    list.appendChild(li);
                }
            });
        }

        function selectItem(n) {
            curItem = n;
            const data = db[curMod][curItem];
            document.getElementById('current-name').innerText = n;
            document.getElementById('item-title-text').innerText = data.title || "àª¶à«€àª°à«àª·àª• àª‰àª®à«‡àª°à«‹...";
            document.getElementById('p-text').innerText = data.provision || "àª®àª¾àª¹àª¿àª¤à«€ àª­àª°à«‹...";
            document.getElementById('fav-btn').style.color = data.fav ? "#f1c40f" : "#ccc";
            renderFiles(); refreshSide(); closePDF();
        }

        // àª¶à«€àª°à«àª·àª• (Title) àª«àª‚àª•à«àª¶àª¨à«àª¸
        function editTitle() {
            document.getElementById('title-display-area').style.display = 'none';
            document.getElementById('title-edit-area').style.display = 'flex';
            document.getElementById('item-title-input').value = db[curMod][curItem].title;
        }

        function saveTitle() {
            db[curMod][curItem].title = document.getElementById('item-title-input').value;
            save();
            document.getElementById('title-display-area').style.display = 'block';
            document.getElementById('title-edit-area').style.display = 'none';
            selectItem(curItem);
        }

        // PDF àª…àª¨à«‡ àª«àª¾àª‡àª² àª¹à«‡àª¨à«àª¡àª²àª¿àª‚àª—
        function viewPDF(url, name) {
            let finalUrl = url;
            if (url.includes('drive.google.com')) {
                const id = url.match(/[-\w]{25,}/);
                if (id) finalUrl = `https://drive.google.com/file/d/${id[0]}/preview`;
            }
            document.getElementById('pdf-frame').src = finalUrl;
            document.getElementById('pdf-title-bar').innerText = "ğŸ“„ " + name;
            document.getElementById('pdf-viewer-container').style.display = 'block';
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function closePDF() { document.getElementById('pdf-viewer-container').style.display = 'none'; document.getElementById('pdf-frame').src = ""; }

        function addFile() {
            const name = document.getElementById('fName').value;
            const url = document.getElementById('fURL').value;
            if(!name || !url) return alert("àª¬àª§à«€ àªµàª¿àª—àª¤ àª­àª°à«‹!");
            db[curMod][curItem].files.push({ id: Date.now(), name, date: document.getElementById('fDate').value, url, type: document.getElementById('fType').value });
            save(); renderFiles();
            document.getElementById('fName').value = ''; document.getElementById('fURL').value = '';
        }

        function renderFiles() {
            const container = document.getElementById('results-area'); container.innerHTML = "";
            const cats = ["CCRA àª¹à«àª•àª®", "àªªàª°àª¿àªªàª¤à«àª°", "àª àª°àª¾àªµ", "àª“àª¡à«€àªŸ àªªà«‡àª°àª¾", "àª•à«‹àª°à«àªŸàª¨àª¾ àªšà«àª•àª¾àª¦àª¾"];
            cats.forEach(c => {
                let filtered = db[curMod][curItem].files.filter(f => f.type === c);
                if(filtered.length > 0) {
                    let h = `<div class="card"><div class="cat-header">${c}</div><table width="100%">`;
                    filtered.forEach(f => {
                        h += `<tr><td>${f.date || '--'}</td><td><a href="javascript:void(0)" onclick="viewPDF('${f.url}', '${f.name}')" style="color:var(--accent); font-weight:600; text-decoration:none;">ğŸ“„ ${f.name}</a></td><td width="30"><button onclick="deleteFile(${f.id})" style="border:none; background:none; cursor:pointer; color:red;">ğŸ—‘ï¸</button></td></tr>`;
                    });
                    container.innerHTML += h + `</table></div>`;
                }
            });
        }

        // àª¬à«‡àª•àª…àªª àª«àª‚àª•à«àª¶àª¨à«àª¸
        function exportData() {
            const blob = new Blob([JSON.stringify(db)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `StampAct_Backup_${new Date().toLocaleDateString()}.json`; a.click();
        }

        function importData(e) {
            const reader = new FileReader();
            reader.onload = (ev) => { db = JSON.parse(ev.target.result); save(); location.reload(); };
            reader.readAsText(e.target.files[0]);
        }

        function editP() { document.getElementById('p-text').style.display='none'; document.getElementById('p-input').style.display='block'; document.getElementById('p-input').value = db[curMod][curItem].provision; document.getElementById('p-save').style.display='block'; document.getElementById('p-edit-btn').style.display='none'; }
        function saveP() { db[curMod][curItem].provision = document.getElementById('p-input').value; save(); selectItem(curItem); document.getElementById('p-text').style.display='block'; document.getElementById('p-input').style.display='none'; document.getElementById('p-save').style.display='none'; document.getElementById('p-edit-btn').style.display='block'; }
        function toggleFav() { db[curMod][curItem].fav = !db[curMod][curItem].fav; save(); refreshSide(); }
        function deleteFile(id) { if(confirm("àª•àª¾àª¢à«€ àª¨àª¾àª–àªµà«àª‚ àª›à«‡?")) { db[curMod][curItem].files = db[curMod][curItem].files.filter(f => f.id !== id); save(); renderFiles(); } }
    </script>
</body>
</html>
