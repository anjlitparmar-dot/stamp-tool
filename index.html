<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <title>Gujarat Stamp Act Tool - Sync</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        /* ркдркорк╛рк░рк╛ рк╕рлНркХрлНрк░рлАркирк╢рлЛркЯ ркорлБркЬркмркирлА ркбрк┐ркЭрк╛ркЗрки */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; margin: 0; }
        .header { background-color: #2c3e50; color: white; padding: 15px; text-align: center; }
        .main-container { display: flex; padding: 20px; gap: 20px; }
        .sidebar { width: 250px; background: #34495e; color: white; border-radius: 8px; padding: 10px; }
        .content-area { flex-grow: 1; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .input-group { display: flex; gap: 10px; margin-top: 20px; align-items: center; background: #f9f9f9; padding: 15px; border-radius: 8px; }
        input, button { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .btn-add { background-color: #1abc9c; color: white; border: none; cursor: pointer; font-weight: bold; }
        .btn-add:hover { background-color: #16a085; }
        #status-msg { color: #e67e22; font-weight: bold; margin-left: 10px; }
    </style>
</head>
<body>

<div class="header">
    <h2>ркЧрлБркЬрк░рк╛ркд рк╕рлНркЯрлЗркорлНркк ркЕркзрк┐ркирк┐ркпрко ркЯрлВрк▓</h2>
    <button id="auth_btn" onclick="handleAuthClick()" style="background:#4285F4; color:white; border:none; padding:8px 15px; cursor:pointer; border-radius:4px;">ЁЯФР Google Drive рк╕рк╛ркерлЗ ркЬрлЛркбрлЛ</button>
</div>

<div class="main-container">
    <div class="sidebar">
        <button style="width:100%; background:#e74c3c; color:white; border:none; padding:10px; margin-bottom:10px;">тЖР ркорлБркЦрлНркп ркорлЗркирлБ</button>
        <div id="section-list">
            <div style="padding:10px; border-bottom:1px solid #455a64;">ркХрк▓рко-рлз</div>
        </div>
    </div>

    <div class="content-area">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>ркХрк▓рко-рлз <span style="font-size:14px; background:#eee; padding:5px; border-radius:4px; cursor:pointer;">ЁЯУЭ ркирк╛рко ркЖрккрлЛ</span></h3>
            <button style="background:#f39c12; color:white; border:none; padding:5px 15px; border-radius:4px;">ЁЯМР Language</button>
        </div>

        <div style="border:1px solid #ffeaa7; background:#fffdf2; padding:15px; border-radius:8px; margin-top:20px;">
            <strong>ЁЯЧ╣ ркХрк╛ркпркжрк╛ркХрлАркп ркЬрлЛркЧрк╡рк╛ркИ:</strong>
            <p>...</p>
        </div>

        <div class="input-group">
            <input type="text" id="entry-val" placeholder="рк╡рк┐ркЧркд (ркжрк╛.ркд. рлкрлжрлж)" style="width:100px;">
            <input type="date" id="entry-date">
            
            <div style="border: 1px solid #ddd; padding: 5px; background: white; border-radius: 4px;">
                <label style="font-size: 12px; display: block; color: #666;">PDF ркЕрккрк▓рлЛркб ркХрк░рлЛ:</label>
                <input type="file" id="pdf-file" accept="application/pdf">
            </div>

            <button class="btn-add" onclick="processAndAdd()">+ ркЙркорлЗрк░рлЛ</button>
            <span id="status-msg"></span>
        </div>
    </div>
</div>

<script>
    const CLIENT_ID = 'ркЕрк╣рлАркВ_ркдркорк╛рк░рлА_CLIENT_ID_ркирк╛ркЦрлЛ'; 
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';

    let tokenClient;
    let gapiInited = false;

    // 1. Initialize APIs
    function gapiLoaded() {
        gapi.load('client', async () => {
            await gapi.client.init({ discoveryDocs: [DISCOVERY_DOC] });
            gapiInited = true;
        });
    }

    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: SCOPES,
            callback: '', 
        });
    }

    function handleAuthClick() {
        tokenClient.callback = async (resp) => {
            if (resp.error !== undefined) throw (resp);
            document.getElementById('auth_btn').innerText = "тЬЕ ркЬрлЛркбрк╛ркпрлЗрк▓ ркЫрлЗ";
            document.getElementById('status-msg').innerText = "Google Drive рк╕рк┐ркВркХ ркЪрк╛рк▓рлБ ркЫрлЗ.";
        };
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    // 2. Main Process: Upload PDF and Save Data
    async function processAndAdd() {
        const val = document.getElementById('entry-val').value;
        const date = document.getElementById('entry-date').value;
        const fileInput = document.getElementById('pdf-file');
        const status = document.getElementById('status-msg');

        if (!val || !date || fileInput.files.length === 0) {
            alert("ркорк╣рлЗрк░ркмрк╛ркирлА ркХрк░рлАркирлЗ ркмркзрлА рк╡рк┐ркЧркдрлЛ ркнрк░рлЛ ркЕркирлЗ PDF рклрк╛ркИрк▓ рккрк╕ркВркж ркХрк░рлЛ.");
            return;
        }

        status.innerText = "тП│ PDF ркЕрккрк▓рлЛркб ркеркИ рк░рк╣рлА ркЫрлЗ...";

        try {
            // PDF ркЕрккрк▓рлЛркб ркХрк░рк╡рк╛ркирлА рккрлНрк░ркХрлНрк░рк┐ркпрк╛
            const file = fileInput.files[0];
            const metadata = { 'name': file.name, 'mimeType': 'application/pdf' };
            const formData = new FormData();
            formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            formData.append('file', file);

            const uploadResponse = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink', {
                method: 'POST',
                headers: new Headers({ 'Authorization': 'Bearer ' + gapi.client.getToken().access_token }),
                body: formData
            });

            const result = await uploadResponse.json();
            const driveLink = result.webViewLink;

            // ркЕрк╣рлАркВ ркдркорлЗ ркдркорк╛рк░рк╛ ркбрлЗркЯрк╛ркмрлЗркЭркорк╛ркВ (Localstorage ркХрлЗ AppData) рк╕рлЗрк╡ ркХрк░рк╡рк╛ркирлБркВ рклркВркХрлНрк╢рки рк▓ркЦрлА рк╢ркХрлЛ
            console.log("Data to Save:", { val, date, pdfLink: driveLink });
            
            status.innerText = "тЬЕ рк╕рклрк│ркдрк╛рккрлВрк░рлНрк╡ркХ ркЙркорлЗрк░рк╛ркИ ркЧркпрлБркВ!";
            alert("ркбрлЗркЯрк╛ ркЕркирлЗ PDF ркЧрлВркЧрк▓ ркбрлНрк░рк╛ркИрк╡ркорк╛ркВ рк╕рлЗрк╡ ркеркИ ркЧркпрк╛ ркЫрлЗ!");
            
            // рклрлЛрк░рлНрко ркХрлНрк▓рк┐ркпрк░ ркХрк░рк╡рлБркВ
            document.getElementById('entry-val').value = '';
            fileInput.value = '';

        } catch (error) {
            console.error(error);
            status.innerText = "тЭМ ркнрлВрк▓ ркЖрк╡рлА!";
        }
    }

    window.onload = () => { gapiLoaded(); };
</script>
<script src="https://accounts.google.com/gsi/client" onload="gisLoaded()" async defer></script>
</body>
</html>
